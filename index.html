<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>병원 스케줄 관리 시스템</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏥 병원 스케줄 관리 시스템</h1>
            <button class="help-btn" onclick="showLegendModal()" title="색상 설명">?</button>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="patient-form">
                    <h3>새 환자 등록</h3>
                    <div class="form-group">
                        <label>환자명</label>
                        <input type="text" id="patientName" placeholder="환자명">
                    </div>
                    <div class="form-group">
                        <label>성별</label>
                        <select id="patientGender">
                            <option value="male">남성</option>
                            <option value="female">여성</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>진료과/상태</label>
                        <select id="patientCondition">
                            <option value="암">암</option>
                            <option value="재활">재활</option>
                            <option value="일반">일반</option>
                            <option value="수술">수술</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>입원 시작일</label>
                        <input type="date" id="admissionDate">
                    </div>
                    <div class="form-group">
                        <label>입원 종료일 / 기간</label>
                        <div class="duration-row">
                            <input type="date" id="dischargeDate" onchange="updateDurationFromDischarge()">
                            <select id="duration" onchange="updateDischargeFromDuration()">
                                <option value="1">1일</option>
                                <option value="2">2일</option>
                                <option value="3">3일</option>
                                <option value="4">4일</option>
                                <option value="5">5일</option>
                                <option value="6">6일</option>
                                <option value="7">7일</option>
                                <option value="8">8일</option>
                                <option value="9">9일</option>
                                <option value="10">10일</option>
                                <option value="11">11일</option>
                                <option value="12">12일</option>
                                <option value="13">13일</option>
                                <option value="14" selected>14일</option>
                                <option value="15">15일</option>
                                <option value="16">16일</option>
                                <option value="17">17일</option>
                                <option value="18">18일</option>
                                <option value="19">19일</option>
                                <option value="20">20일</option>
                                <option value="21">21일</option>
                                <option value="22">22일</option>
                                <option value="23">23일</option>
                                <option value="24">24일</option>
                                <option value="25">25일</option>
                                <option value="26">26일</option>
                                <option value="27">27일</option>
                                <option value="28">28일</option>
                                <option value="29">29일</option>
                                <option value="30">30일</option>
                                <option value="31">31일</option>
                                <option value="32">32일</option>
                                <option value="33">33일</option>
                                <option value="34">34일</option>
                                <option value="35">35일</option>
                                <option value="36">36일</option>
                                <option value="37">37일</option>
                                <option value="38">38일</option>
                                <option value="39">39일</option>
                                <option value="40">40일</option>
                                <option value="41">41일</option>
                                <option value="42">42일</option>
                                <option value="43">43일</option>
                                <option value="44">44일</option>
                                <option value="45">45일</option>
                                <option value="46">46일</option>
                                <option value="47">47일</option>
                                <option value="48">48일</option>
                                <option value="49">49일</option>
                                <option value="50">50일</option>
                                <option value="51">51일</option>
                                <option value="52">52일</option>
                                <option value="53">53일</option>
                                <option value="54">54일</option>
                                <option value="55">55일</option>
                                <option value="56">56일</option>
                                <option value="57">57일</option>
                                <option value="58">58일</option>
                                <option value="59">59일</option>
                                <option value="60">60일</option>
                                <option value="60+">60+일</option>
                            </select>
                        </div>
                        <div class="longterm-container">
                            <label class="longterm-label" for="longtermCheck">장기입원 (퇴원일 미정)</label>
                            <input type="checkbox" class="longterm-checkbox" id="longtermCheck" onchange="toggleLongterm()">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>입원 유형</label>
                        <select id="admissionType">
                            <option value="admitted">입원 확정</option>
                            <option value="reserved">예약</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>병실타입</label>
                        <select id="roomType">
                            <option value="any">상관없음</option>
                            <option value="1인실">1인실</option>
                            <option value="2인실">2인실</option>
                            <option value="4인실">4인실</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>특이사항</label>
                        <textarea id="patientNotes" placeholder="알레르기, 특별 요구사항 등"></textarea>
                    </div>
                   <div class="form-group">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label style="margin: 0; min-width: 80px;">배정 베드</label>
                            <input type="text" id="selectedBed" disabled style="background: #f0f0f0; flex: 1;" placeholder="">
                        </div>
                    </div>
                    <button class="btn" style="background: #17a2b8;" onclick="findAvailableBeds()">베드 선택</button>
                    <button class="btn" style="background: #FF9800;" onclick="findRecommendations()">병실 추천받기</button>
                    <button class="btn" onclick="addPatient()">환자 등록</button>
                </div>
                
                <div id="recommendations" style="display: none;"></div>
                <!-- 데이터 관리 - 미니멀 버전 -->
                <div style="border-top: 1px solid #e0e0e0; padding-top: 12px; margin-top: 15px;">
                    <details style="cursor: pointer;">
                        <summary style="font-size: 12px; color: #999; user-select: none; list-style: none; display: flex; align-items: center; gap: 5px;">
                            <span style="font-size: 10px;">▶</span>
                            <span>데이터 관리</span>
                        </summary>
                        <div style="margin-top: 10px; display: flex; flex-direction: column; gap: 5px;">
                            <button class="btn" style="background: #6c757d; padding: 6px 12px; font-size: 12px;" onclick="showDownloadOptions()">
                                📥 다운로드
                            </button>
                            <button class="btn" style="background: #6c757d; padding: 6px 12px; font-size: 12px;" onclick="document.getElementById('importFile').click()">
                                📤 업로드
                            </button>
                            <input type="file" id="importFile" accept=".json,.xlsx" style="display: none;" onchange="importPatients(event)">
                            <button class="btn" style="background: #dc3545; padding: 6px 12px; font-size: 12px;" onclick="resetPatients()">
                                🗑️ 전체삭제
                            </button>
                        </div>
                    </details>
                </div>
            </div>

            <div class="schedule-area">
                <div class="schedule-header">
                    <div class="date-nav">
                        <button class="nav-btn" onclick="moveDate(-10)" title="10일 이전">&lt;&lt;</button>
                        <button class="nav-btn" onclick="moveDate(-1)" title="1일 이전">&lt;</button>
                        <span class="date-range" id="dateRange"></span>
                        <button class="nav-btn" onclick="moveDate(1)" title="1일 이후">&gt;</button>
                        <button class="nav-btn" onclick="moveDate(10)" title="10일 이후">&gt;&gt;</button>
                    </div>
                </div>

                <div class="schedule-container">
                    <div class="schedule-table-wrapper">
                        <table class="schedule-table" id="scheduleTable">
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="legend-modal" id="legendModal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeLegendModal()">&times;</span>
            <h3>색상 설명</h3>
            <div class="legend">
                <div class="legend-section">
                    <h4>베드 상태</h4>
                    <div class="legend-item">
                        <div class="legend-color bed-empty"></div>
                        <span>빈 베드</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color bed-admitted-male"></div>
                        <span>입원중 (남성)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color bed-admitted-female"></div>
                        <span>입원중 (여성)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color bed-reserved-male"></div>
                        <span>예약 (남성)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color bed-reserved-female"></div>
                        <span>예약 (여성)</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="patient-modal" id="patientModal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modalBody"></div>
        </div>
    </div>

    <div class="patient-detail-modal" id="patientDetailModal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closePatientDetailModal()">&times;</span>
            <div id="patientDetailBody"></div>
        </div>
    </div>

    <div class="date-summary-modal" id="dateSummaryModal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeDateSummaryModal()">&times;</span>
            <div id="dateSummaryBody"></div>
        </div>
    </div>
    
    <div class="bed-schedule-modal" id="bedScheduleModal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeBedScheduleModal()">&times;</span>
            <div id="bedScheduleBody"></div>
        </div>
    </div>
    
    <div class="bed-selection-modal" id="bedSelectionModal" style="display: none;">
        <div class="modal-content" style="max-width: 700px; max-height: 80vh; overflow-y: auto;">
            <span class="close" onclick="closeBedSelectionModal()">&times;</span>
            <div id="bedSelectionBody"></div>
        </div>
    </div>

    <div class="patient-edit-modal" id="patientEditModal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close" onclick="closePatientEditModal()">&times;</span>
            <h3>환자 정보 수정</h3>
            <div class="patient-form" style="border: none; padding: 0; margin: 0;">
                <div class="form-group">
                    <label>환자명</label>
                    <input type="text" id="editPatientName" placeholder="환자명">
                </div>
                <div class="form-group">
                    <label>성별</label>
                    <select id="editPatientGender">
                        <option value="male">남성</option>
                        <option value="female">여성</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>진료과/상태</label>
                    <select id="editPatientCondition">
                        <option value="암">암</option>
                        <option value="재활">재활</option>
                        <option value="일반">일반</option>
                        <option value="수술">수술</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>입원 시작일</label>
                    <input type="date" id="editAdmissionDate">
                </div>
                <div class="form-group">
                    <label>입원 종료일 / 기간</label>
                    <div class="duration-row">
                        <input type="date" id="editDischargeDate" onchange="updateEditDurationFromDischarge()">
                        <select id="editDuration" onchange="updateEditDischargeFromDuration()">
                            <option value="1">1일</option>
                            <option value="2">2일</option>
                            <option value="3">3일</option>
                            <option value="4">4일</option>
                            <option value="5">5일</option>
                            <option value="6">6일</option>
                            <option value="7">7일</option>
                            <option value="8">8일</option>
                            <option value="9">9일</option>
                            <option value="10">10일</option>
                            <option value="11">11일</option>
                            <option value="12">12일</option>
                            <option value="13">13일</option>
                            <option value="14" selected>14일</option>
                            <option value="15">15일</option>
                            <option value="16">16일</option>
                            <option value="17">17일</option>
                            <option value="18">18일</option>
                            <option value="19">19일</option>
                            <option value="20">20일</option>
                            <option value="21">21일</option>
                            <option value="22">22일</option>
                            <option value="23">23일</option>
                            <option value="24">24일</option>
                            <option value="25">25일</option>
                            <option value="26">26일</option>
                            <option value="27">27일</option>
                            <option value="28">28일</option>
                            <option value="29">29일</option>
                            <option value="30">30일</option>
                            <option value="31">31일</option>
                            <option value="32">32일</option>
                            <option value="33">33일</option>
                            <option value="34">34일</option>
                            <option value="35">35일</option>
                            <option value="36">36일</option>
                            <option value="37">37일</option>
                            <option value="38">38일</option>
                            <option value="39">39일</option>
                            <option value="40">40일</option>
                            <option value="41">41일</option>
                            <option value="42">42일</option>
                            <option value="43">43일</option>
                            <option value="44">44일</option>
                            <option value="45">45일</option>
                            <option value="46">46일</option>
                            <option value="47">47일</option>
                            <option value="48">48일</option>
                            <option value="49">49일</option>
                            <option value="50">50일</option>
                            <option value="51">51일</option>
                            <option value="52">52일</option>
                            <option value="53">53일</option>
                            <option value="54">54일</option>
                            <option value="55">55일</option>
                            <option value="56">56일</option>
                            <option value="57">57일</option>
                            <option value="58">58일</option>
                            <option value="59">59일</option>
                            <option value="60">60일</option>
                            <option value="60+">60+일</option>
                        </select>
                    </div>
                    <div class="longterm-container">
                        <label class="longterm-label" for="editLongtermCheck">장기입원 (퇴원일 미정)</label>
                        <input type="checkbox" class="longterm-checkbox" id="editLongtermCheck" onchange="toggleEditLongterm()">
                    </div>
                </div>
                <div class="form-group">
                    <label>입원 유형</label>
                    <select id="editAdmissionType">
                        <option value="admitted">입원 확정</option>
                        <option value="reserved">예약</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>병실타입</label>
                    <select id="editRoomType">
                        <option value="any">상관없음</option>
                        <option value="1인실">1인실</option>
                        <option value="2인실">2인실</option>
                        <option value="4인실">4인실</option>
                    </select>
                </div>
               <div class="form-group">
                    <label>배정 베드</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="text" id="editPatientBed" disabled style="background: #f0f0f0; flex: 1;">
                        <button class="btn" style="background: #17a2b8; padding: 8px 16px; margin: 0; width: auto;" onclick="changeBedForEdit()">베드 변경</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>특이사항</label>
                    <textarea id="editPatientNotes" placeholder="알레르기, 특별 요구사항 등"></textarea>
                </div>
               <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn" style="background: #28a745; flex: 1;" onclick="savePatientFromModal()">저장</button>
                    <button class="btn" style="background: #6c757d; flex: 1;" onclick="cancelPatientModal()">취소</button>
                </div>
            </div>
        </div>
    </div>
    <div class="download-option-modal" id="downloadOptionModal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <span class="close" onclick="closeDownloadOptionModal()">&times;</span>
            <h3>다운로드 형식 선택</h3>
            <p style="font-size: 13px; color: #666; margin: 10px 0 20px 0;">
                총 <strong>${patients.length}명</strong>의 환자 데이터를 다운로드합니다.
            </p>
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <button class="btn" style="background: #17a2b8;" onclick="exportPatients('json')">
                    📄 JSON 형식 (.json)
                    <div style="font-size: 11px; color: rgba(255,255,255,0.8); margin-top: 3px;">백업/복구용 (모든 데이터 보존)</div>
                </button>
                <button class="btn" style="background: #28a745;" onclick="exportPatients('excel')">
                    📊 Excel 형식 (.xlsx)
                    <div style="font-size: 11px; color: rgba(255,255,255,0.8); margin-top: 3px;">엑셀에서 열람/편집 가능</div>
                </button>
            </div>
        </div>
    </div>
    <button class="floating-today-btn" onclick="goToToday()" title="오늘로 이동">오늘</button>
    <button class="floating-add-patient-btn" onclick="openNewPatientModal()" title="환자 등록">+</button>
    <script src="js/config.js"></script>
    <script src="js/data.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/recommendation.js"></script>
    <script src="js/patient.js"></script>
    <script src="js/bed-selection.js"></script>
    <script src="js/bed-move.js"></script>
    <script src="js/export.js"></script>
    <script src="js/ui.js"></script> 
</body>
</html>
